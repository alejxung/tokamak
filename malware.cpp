#include <arpa/inet.h>
#include <cstring>
#include <iostream>
#include <netinet/in.h>
#include <sys/socket.h>
#include <sys/wait.h>
#include <unistd.h>

void try_fork_bomb() {
	std::cout << "[Attack 1] Attempting Fork Bomb..." << std::endl;
	pid_t pid = fork();
	if (pid == 0) {
		std::cout << "   >>> SUCCESS: I duplicated myself! (Vulnerable)"
				  << std::endl;
		exit(0);
	} else if (pid > 0) {
		wait(NULL);
	} else {
		perror("   >>> BLOCKED: Fork failed");
	}
}

void try_network() {
	std::cout << "[Attack 2] Attempting to open Socket..." << std::endl;
	int sock = socket(AF_INET, SOCK_STREAM, 0);
	if (sock < 0) {
		perror("   >>> BLOCKED: Socket failed");
	} else {
		std::cout << "   >>> SUCCESS: Socket opened! (Vulnerable)" << std::endl;
		close(sock);
	}
}

void try_read_secret() {
	std::cout << "[Attack 3] Attempting to read /etc/hostname (Host file)..."
			  << std::endl;
	FILE *f = fopen("/etc/hostname", "r");
	if (f) {
		char buffer[128];
		if (fgets(buffer, 128, f)) {
			std::cout << "   >>> SUCCESS: Read file: " << buffer
					  << " (Vulnerable)" << std::endl;
		}
		fclose(f);
	} else {
		perror("   >>> BLOCKED: File read failed");
	}
}

int main() {
	std::cout << "--- STARTING MALWARE SEQUENCE ---" << std::endl;
	try_fork_bomb();
	try_network();
	try_read_secret();
	std::cout << "--- MALWARE SEQUENCE FINISHED ---" << std::endl;
	return 0;
}